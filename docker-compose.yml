services:
  fulgurant:
    build:
      context: .
      dockerfile: Dockerfile
    image: fulgurant:latest
    container_name: fulgurant
    restart: unless-stopped

    # Port mapping
    ports:
      - "3000:3000"

    # Environment variables
    environment:
      # Database
      - DATABASE_URL=sqlite:/data/fulgurant.db

      # SMTP configuration (required for production)
      - SMTP_HOST=smtp.mail.ovh.net
      - SMTP_PORT=587
      - SMTP_LOGIN=mail@example.com
      - SMTP_PASSWORD=your_password_here

      # Server configuration
      - IS_PROD=true
      - SHARE_VALIDITY_DAYS=3
      - CAN_REGISTER=false
      - MAX_DEVICES_PER_USER=10
      - SSE_HEARTBEAT_SECONDS=30

      # Network configuration
      - BIND_HOST=0.0.0.0
      - BIND_PORT=3000

      # TLS/HTTPS (optional - uncomment to enable)
      # - TLS_CERT_PATH=/data/certs/cert.pem
      # - TLS_KEY_PATH=/data/certs/key.pem

      # Logging
      - RUST_LOG=info
      - LOG_FOLDER=/data/logs

      # User/Group IDs (match your host user for proper permissions)
      - PUID=1000
      - PGID=1000

    # Persistent data volume
    volumes:
      - ./data:/data
      # Optional: mount TLS certificates
      # - ./certs:/data/certs:ro

    # Health check
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/ping"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3

    # Resource limits (optional but recommended)
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M

    # Security options
    security_opt:
      - no-new-privileges:true

    # Read-only root filesystem (except /data and /tmp)
    # read_only: true
    # tmpfs:
    #   - /tmp
